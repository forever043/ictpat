{% extends "common/mgrbase.html" %}
{% load staticfiles %}

{% block csslink %}
{{ block.super }}
<link rel="stylesheet" href="{% static "css/jquery.dataTables.css" %}" type="text/css" media="screen" />
{% endblock %}


{% block scripts %}
{{ block.super }}
<script type="text/javascript" src="{% static "scripts/jquery.jeditable.mini.js" %}"></script>
<script type="text/javascript" src="{% static "scripts/jquery.dataTables.min.js" %}"></script>
<script type="text/javascript" src="{% static "scripts/simpla.dataTables.configuration.js" %}"></script>

<script type="text/javascript">
	$(document).ready(function() {
		// Reset filter form
		$("#reset").click(function() {
			window.location.href='{% url "patent-list-fresh" %}';
			return false;
		});

		// Delete
		$(".delete").click(function(){
			$.post(this.href, function(data) {
				if (data.result == "ok"){
					$(this).parent().parent().remove();
					alert("删除成功");
				} else {
					// handle error processed by server here
					alert("删除失败：" + data.result);
				}
			}).fail(function() {
				// handle unexpected error here
				alert("error");
			});
			return false;
		});
	});

$(document).ready(function() {
	var queryTable = $('#patent-list').dataTable({
		"bProcessing": true,
		"bServerSide": true,
		"sAjaxSource": "{% url "patent-list-json" %}",
		"bSort": false,
		"sPaginationType": "full_numbers",
		"oLanguage": oLanguage,
		// Column Design
		"bAutoWidth": false,
		"aoColumns": [
			{ "mData": "department",		"sWidth": "15%" },
			{ "mData": "name",				"sWidth": "28%",
				"fnRender": function (o, v) {
					return '<a href="#">' + v + '</a>'
				}},
			{ "mData": "inventors", 		"sWidth": "20%"},
			{ "mData": "apply_code",		"sWidth": "10%" },
			{ "mData": "apply_date",		"sWidth": "8%" },
			{ "mData": "authorize_code",	"sWidth": "11%" },
			{ "mData": "pk",				"sWidth": "8%",
				"fnRender": function (o, v) {
					return '<a href="#" title="Edit"><img src="/resources/images/icons/pencil.png" alt="Edit" /></a>'
						 + '<a href="#" class="delete" title="Delete"><img src="/resources/images/icons/cross.png" alt="Delete" /></a>'
						 + '<a href="#" title="Edit Meta"><img src="/resources/images/icons/hammer_screwdriver.png" alt="Edit Meta" /></a>';
				}}
		],
		"fnDrawCallback": function () {
			// MouseOver high-light
			$(".datatable tr").not(':first').hover(
				function () { $(this).addClass('selected-row'); }, 
				function () { $(this).removeClass('selected-row'); }
			);
		},
	});
});

</script>
{% endblock %}

{% block main_content %}
			
			<!-- Page Head -->
			<h2>专利列表查询</h2>
			<p id="page-intro">快捷任务列表</p>

			<div class="content-box{% if scr_list %} closed-box{% endif %}"><!-- Start Content Box -->
				
				<div class="content-box-header">
					
					<h3>检索条件</h3>

					<div class="clear"></div>
					
				</div> <!-- End .content-box-header -->
				
				<div class="content-box-content">

					<div class="tab-content default-tab" >
					
						<form action="{% url 'patent-list' %}" method="post">

							{% csrf_token %}

							<fieldset>

								<p>
									<label>
									{{ form.department.label }}
									{% if form.department.errors %}
									<span class="input-notification error png_bg"></span>
									{% endif %}
									{{ form.department }}
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

									{{ form.type.label }}
									{% if form.type.errors %}
									<span class="input-notification error png_bg"></span>
									{% endif %}
									{{ form.type }}
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

									{{ form.state.label }}
									{% if form.state.errors %}
									<span class="input-notification error png_bg"></span>
									{% endif %}
									{{ form.state }}

									</label>
								</p>

							</fieldset>
							
							<fieldset class="column-left">
								
								<p>
									<label>
										{{ form.name.label }}
										{% if form.name.errors %}
										<span class="input-notification error png_bg">
											{% for error in form.name.errors %}
											{{ error }}
											{% endfor %}
										</span>
										{% endif %}
									</label>
									{{ form.name }}
								</p>

								<p>
									<label>
										{{ form.inventors.label }}
										{% if form.inventors.errors %}
										<span class="input-notification error png_bg">
											{% for error in form.inventors.errors %}
											{{ error }}
											{% endfor %}
										</span>
										{% endif %}
									</label>
									{{ form.inventors }}
								</p>

							</fieldset>

							<fieldset class="column-right">

								<p>
									<label>
										{{ form.apply_code.label }}
										{% if form.apply_code.errors %}
										<span class="input-notification error png_bg">
											{% for error in form.apply_code.errors %}
											{{ error }}
											{% endfor %}
										</span>
										{% endif %}
									</label>
									{{ form.apply_code }}
								</p>
								<p>
									<label>
										{{ form.authorize_code.label }}
										{% if form.authorize_code.errors %}
										<span class="input-notification error png_bg">
											{% for error in form.authorize_code.errors %}
											{{ error }}
											{% endfor %}
										</span>
										{% endif %}
									</label>
									{{ form.authorize_code }}
								</p>
								
							</fieldset>

							<div class="clear"></div><!-- End .clear -->

							<p>

								<input class="button" type="submit" id="search" name="search" value="检索" />
								<input class="button" type="submit" id="reset" name="reset" value="重置" />

							</p>
							
						</form>
						
					</div> <!-- End #tab2 -->		
					
				</div> <!-- End .content-box-content -->
				
			</div> <!-- End .content-box -->
					

			<div class="content-box"><!-- Start Content Box -->
				
				<div class="content-box-header">
					
					<h3>检索结果</h3>
					
					<ul class="content-box-tabs">
						<li><a href="#tab1" class="default-tab">全部专利</a></li> <!-- href must be unique and match the id of target div -->
						<li><a href="#tab2">已授权专利</a></li>
					</ul>
					
					<div class="clear"></div>
					
				</div> <!-- End .content-box-header -->
				
				<div class="content-box-content">
					
					<div class="tab-content default-tab" id="tab1"> <!-- This is the target div. id must match the href of this div's tab -->
						
						{% include "common/notifymsg.html" %}

						{% if not scr_list %}
						无结果
						{% else %}
						<table>
							
							<thead>
							<tr>
								<th><input class="check-all" type="checkbox" /></th>
								<th>申请部门</th>
								<th>专利名称</th>
								<th>发明人</th>
								<th>申请号</th>
								<th>申请时间</th>
								<th>授权号</th>
								<th>操作</th>
							</tr>
								
							</thead>
						 
							<tfoot>
								<tr>
									<td colspan="6">
										<div class="bulk-actions align-left">
											<select name="dropdown">
												<option value="option1">Choose an action...</option>
												<option value="option2">Edit</option>
												<option value="option3">Delete</option>
											</select>
											<a class="button" href="#">Apply to selected</a>
										</div>
										
										<div class="pagination">
											<a href="{% if not page_obj.has_previous %}javascript:void(0){% else %}{% url 'patent-list' %}?page=1{% endif %}" title="First Page">&laquo; First</a>
											<a href="{% if not page_obj.has_previous %}javascript:void(0){% else %}{% url 'patent-list' %}?page={{ page_obj.previous_page_number }}{% endif %}" title="Previous Page">&laquo; Previous</a>
											

											{% for pid in page_obj.paginator.page_range %}
											<a href="{% url 'patent-list' %}?page={{ pid }}" class="number{% ifequal pid page_obj.number %} current{% endifequal %}" title="{{pid}}">{{pid}}</a>
											{% endfor %}

											<a href="{% if not page_obj.has_next %}javascript:void(0){% else %}{% url 'patent-list' %}?page={{ page_obj.next_page_number }}{% endif %}" title="Next page">Next &raquo;</a>

											<a href="{% if not page_obj.has_next %}javascript:void(0){% else %}{% url 'patent-list' %}?page={{ page_obj.paginator.num_pages }}{% endif %}" title="Last Page">Last &raquo;</a>
										</div> <!-- End .pagination -->
										
										<div class="clear"></div>
									</td>
								</tr>
							</tfoot>
						 
							<tbody>
								{% for patent in scr_list %}
								<tr>
									<td><input type="checkbox" /></td>
									<td>{{ patent.department.name }}</td>
									<td><a href="{% url 'patent-detail' patent.id %}" title="点击查看详细信息">{{ patent.name }}</a></td>
									<td>{{ patent.inventors }}</td>
									<td>{{ patent.apply_code }}</td>
									<td>{{ patent.apply_date|date:"Y-m-d" }}</td>
									<td>{% if patent.authorize_code %}{{ patent.authorize_code}}{% else %}{{patent.state}}{% endif %}</td>
									<td>
										<!-- Icons -->
										<a href="{% url 'patent-edit' patent.id %}" title="编辑">
											<img src="{% static "images/icons/pencil.png" %}" alt="Edit" />
										</a>
										<a href="{% url 'patent-delete' patent.id %}" class="delete" title="删除">
											<img src="{% static "images/icons/cross.png" %}" alt="Delete" />
										</a>
										<a href="{% url 'patent-rank' patent.id %}" title="评级">
											<img src="{% static "images/icons/hammer_screwdriver.png" %}" alt="Edit Meta" />
										</a>
									</td>
								</tr>
								{% endfor %}
							</tbody>
							
						</table>

						<!-- End if scr_list -->
						{% endif %}
						
					</div> <!-- End #tab1 -->
					
					<div class="tab-content" id="tab2">

						<table id="patent-list" class="datatable">
							<thead>
							<tr>
<!--
								<th><input class="check-all" type="checkbox" /></th>
-->
								<th>申请部门</th>
								<th>专利名称</th>
								<th>发明人</th>
								<th>申请号</th>
								<th>申请时间</th>
								<th>授权号</th>
								<th>操作</th>
							</tr>
							</thead>
						</table>

						<div class="clear"></div>
					
					</div> <!-- End #tab2 -->		
					
				</div> <!-- End .content-box-content -->
				
			</div> <!-- End .content-box -->
{% endblock %}

